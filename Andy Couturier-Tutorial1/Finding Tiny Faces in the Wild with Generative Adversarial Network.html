<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Finding Tiny Faces in the Wild with Generative Adversarial Network</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/screen.css">

    <link rel="shortcut icon" href="https://smoolak.com/favicon.png" type="image/png">
    <link rel="canonical" href="https://smoolak.com/p/16f275f7-39f4-4be7-9c2b-5cbeb4b5529b/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="https://smoolak.com/p/16f275f7-39f4-4be7-9c2b-5cbeb4b5529b/amp/">
    
    <meta property="og:site_name" content="Smoolak's blog">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Finding Tiny Faces in the Wild with Generative Adversarial Network">
    <meta property="og:description" content="Today's post will be discussing the work by Bai et al and their paper entitled &amp;quot;Finding Tiny Faces in the Wild with Generative Adversarial Network&amp;quot;. A detailed description of the deep neural network architecture will be given alongside with PyTorch code snippets and a full PyTorch implementation of">
    <meta property="og:url" content="https://smoolak.com/p/16f275f7-39f4-4be7-9c2b-5cbeb4b5529b/">
    <meta property="article:modified_time" content="2019-03-07T03:18:13.000Z">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Finding Tiny Faces in the Wild with Generative Adversarial Network">
    <meta name="twitter:description" content="Today's post will be discussing the work by Bai et al and their paper entitled &amp;quot;Finding Tiny Faces in the Wild with Generative Adversarial Network&amp;quot;. A detailed description of the deep neural network architecture will be given alongside with PyTorch code snippets and a full PyTorch implementation of">
    <meta name="twitter:url" content="https://smoolak.com/p/16f275f7-39f4-4be7-9c2b-5cbeb4b5529b/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Andy Couturier">
    <meta name="twitter:site" content="@Smoolak">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Smoolak&#x27;s blog",
        "logo": "https://smoolak.com/content/images/2018/06/bigicon-1.png"
    },
    "author": {
        "@type": "Person",
        "name": "Andy Couturier",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/e9c0fa6b5bc2dcfa16d8e9932d4ce0bb?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://smoolak.com/author/andy/",
        "sameAs": []
    },
    "headline": "Finding Tiny Faces in the Wild with Generative Adversarial Network",
    "url": "https://smoolak.com/p/16f275f7-39f4-4be7-9c2b-5cbeb4b5529b/",
    "dateModified": "2019-03-07T03:18:13.000Z",
    "description": "Today&#x27;s post will be discussing the work by Bai et al and their paper entitled &amp;quot;Finding Tiny Faces in the Wild with Generative Adversarial Network&amp;quot;. A detailed description of the deep neural network architecture will be given alongside with PyTorch code snippets and a full PyTorch implementation of",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://smoolak.com/"
    }
}
    </script>

    <script src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/ghost-sdk.js"></script>
<script>
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "b9f32b8d7dcd"
});
</script>
    <meta name="generator" content="Ghost 1.24">
    <link rel="alternate" type="application/rss+xml" title="Smoolak's blog" href="https://smoolak.com/rss/">
    <link href="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/prism.css" rel="stylesheet">

<style id="fit-vids-style">.fluid-width-video-container{flex-grow: 1;width:100%;}.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.mjx-chtml {display: inline-block; line-height: 0; text-indent: 0; text-align: left; text-transform: none; font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; letter-spacing: normal; word-wrap: normal; word-spacing: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; margin: 0; padding: 1px 0}
.MJXc-display {display: block; text-align: center; margin: 1em 0; padding: 0}
.mjx-chtml[tabindex]:focus, body :focus .mjx-chtml[tabindex] {display: inline-table}
.mjx-full-width {text-align: center; display: table-cell!important; width: 10000em}
.mjx-math {display: inline-block; border-collapse: separate; border-spacing: 0}
.mjx-math * {display: inline-block; -webkit-box-sizing: content-box!important; -moz-box-sizing: content-box!important; box-sizing: content-box!important; text-align: left}
.mjx-numerator {display: block; text-align: center}
.mjx-denominator {display: block; text-align: center}
.MJXc-stacked {height: 0; position: relative}
.MJXc-stacked > * {position: absolute}
.MJXc-bevelled > * {display: inline-block}
.mjx-stack {display: inline-block}
.mjx-op {display: block}
.mjx-under {display: table-cell}
.mjx-over {display: block}
.mjx-over > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-under > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-stack > .mjx-sup {display: block}
.mjx-stack > .mjx-sub {display: block}
.mjx-prestack > .mjx-presup {display: block}
.mjx-prestack > .mjx-presub {display: block}
.mjx-delim-h > .mjx-char {display: inline-block}
.mjx-surd {vertical-align: top}
.mjx-mphantom * {visibility: hidden}
.mjx-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 2px 3px; font-style: normal; font-size: 90%}
.mjx-annotation-xml {line-height: normal}
.mjx-menclose > svg {fill: none; stroke: currentColor}
.mjx-mtr {display: table-row}
.mjx-mlabeledtr {display: table-row}
.mjx-mtd {display: table-cell; text-align: center}
.mjx-label {display: table-row}
.mjx-box {display: inline-block}
.mjx-block {display: block}
.mjx-span {display: inline}
.mjx-char {display: block; white-space: pre}
.mjx-itable {display: inline-table; width: auto}
.mjx-row {display: table-row}
.mjx-cell {display: table-cell}
.mjx-table {display: table; width: 100%}
.mjx-line {display: block; height: 0}
.mjx-strut {width: 0; padding-top: 1em}
.mjx-vsize {width: 0}
.MJXc-space1 {margin-left: .167em}
.MJXc-space2 {margin-left: .222em}
.MJXc-space3 {margin-left: .278em}
.mjx-chartest {display: block; visibility: hidden; position: absolute; top: 0; line-height: normal; font-size: 500%}
.mjx-chartest .mjx-char {display: inline}
.mjx-chartest .mjx-box {padding-top: 1000px}
.MJXc-processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MJXc-processed {display: none}
.mjx-test {display: block; font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.mjx-ex-box-test {position: absolute; width: 1px; height: 60ex}
.mjx-line-box-test {display: table!important}
.mjx-line-box-test span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
#MathJax_CHTML_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.mjx-chtml .mjx-noError {line-height: 1.2; vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
.MJXc-TeX-unknown-R {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: normal; font-weight: normal}
.MJXc-TeX-unknown-I {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: italic; font-weight: normal}
.MJXc-TeX-unknown-B {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: normal; font-weight: bold}
.MJXc-TeX-unknown-BI {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: italic; font-weight: bold}
.MJXc-TeX-ams-R {font-family: MJXc-TeX-ams-R,MJXc-TeX-ams-Rw}
.MJXc-TeX-cal-B {font-family: MJXc-TeX-cal-B,MJXc-TeX-cal-Bx,MJXc-TeX-cal-Bw}
.MJXc-TeX-frak-R {font-family: MJXc-TeX-frak-R,MJXc-TeX-frak-Rw}
.MJXc-TeX-frak-B {font-family: MJXc-TeX-frak-B,MJXc-TeX-frak-Bx,MJXc-TeX-frak-Bw}
.MJXc-TeX-math-BI {font-family: MJXc-TeX-math-BI,MJXc-TeX-math-BIx,MJXc-TeX-math-BIw}
.MJXc-TeX-sans-R {font-family: MJXc-TeX-sans-R,MJXc-TeX-sans-Rw}
.MJXc-TeX-sans-B {font-family: MJXc-TeX-sans-B,MJXc-TeX-sans-Bx,MJXc-TeX-sans-Bw}
.MJXc-TeX-sans-I {font-family: MJXc-TeX-sans-I,MJXc-TeX-sans-Ix,MJXc-TeX-sans-Iw}
.MJXc-TeX-script-R {font-family: MJXc-TeX-script-R,MJXc-TeX-script-Rw}
.MJXc-TeX-type-R {font-family: MJXc-TeX-type-R,MJXc-TeX-type-Rw}
.MJXc-TeX-cal-R {font-family: MJXc-TeX-cal-R,MJXc-TeX-cal-Rw}
.MJXc-TeX-main-B {font-family: MJXc-TeX-main-B,MJXc-TeX-main-Bx,MJXc-TeX-main-Bw}
.MJXc-TeX-main-I {font-family: MJXc-TeX-main-I,MJXc-TeX-main-Ix,MJXc-TeX-main-Iw}
.MJXc-TeX-main-R {font-family: MJXc-TeX-main-R,MJXc-TeX-main-Rw}
.MJXc-TeX-math-I {font-family: MJXc-TeX-math-I,MJXc-TeX-math-Ix,MJXc-TeX-math-Iw}
.MJXc-TeX-size1-R {font-family: MJXc-TeX-size1-R,MJXc-TeX-size1-Rw}
.MJXc-TeX-size2-R {font-family: MJXc-TeX-size2-R,MJXc-TeX-size2-Rw}
.MJXc-TeX-size3-R {font-family: MJXc-TeX-size3-R,MJXc-TeX-size3-Rw}
.MJXc-TeX-size4-R {font-family: MJXc-TeX-size4-R,MJXc-TeX-size4-Rw}
@font-face {font-family: MJXc-TeX-ams-R; src: local('MathJax_AMS'), local('MathJax_AMS-Regular')}
@font-face {font-family: MJXc-TeX-ams-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_AMS-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-B; src: local('MathJax_Caligraphic Bold'), local('MathJax_Caligraphic-Bold')}
@font-face {font-family: MJXc-TeX-cal-Bx; src: local('MathJax_Caligraphic'); font-weight: bold}
@font-face {font-family: MJXc-TeX-cal-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-R; src: local('MathJax_Fraktur'), local('MathJax_Fraktur-Regular')}
@font-face {font-family: MJXc-TeX-frak-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-B; src: local('MathJax_Fraktur Bold'), local('MathJax_Fraktur-Bold')}
@font-face {font-family: MJXc-TeX-frak-Bx; src: local('MathJax_Fraktur'); font-weight: bold}
@font-face {font-family: MJXc-TeX-frak-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-BI; src: local('MathJax_Math BoldItalic'), local('MathJax_Math-BoldItalic')}
@font-face {font-family: MJXc-TeX-math-BIx; src: local('MathJax_Math'); font-weight: bold; font-style: italic}
@font-face {font-family: MJXc-TeX-math-BIw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Math-BoldItalic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-BoldItalic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-BoldItalic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-R; src: local('MathJax_SansSerif'), local('MathJax_SansSerif-Regular')}
@font-face {font-family: MJXc-TeX-sans-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-B; src: local('MathJax_SansSerif Bold'), local('MathJax_SansSerif-Bold')}
@font-face {font-family: MJXc-TeX-sans-Bx; src: local('MathJax_SansSerif'); font-weight: bold}
@font-face {font-family: MJXc-TeX-sans-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-I; src: local('MathJax_SansSerif Italic'), local('MathJax_SansSerif-Italic')}
@font-face {font-family: MJXc-TeX-sans-Ix; src: local('MathJax_SansSerif'); font-style: italic}
@font-face {font-family: MJXc-TeX-sans-Iw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Italic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Italic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-script-R; src: local('MathJax_Script'), local('MathJax_Script-Regular')}
@font-face {font-family: MJXc-TeX-script-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Script-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Script-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Script-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-type-R; src: local('MathJax_Typewriter'), local('MathJax_Typewriter-Regular')}
@font-face {font-family: MJXc-TeX-type-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Typewriter-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Typewriter-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Typewriter-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-R; src: local('MathJax_Caligraphic'), local('MathJax_Caligraphic-Regular')}
@font-face {font-family: MJXc-TeX-cal-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-B; src: local('MathJax_Main Bold'), local('MathJax_Main-Bold')}
@font-face {font-family: MJXc-TeX-main-Bx; src: local('MathJax_Main'); font-weight: bold}
@font-face {font-family: MJXc-TeX-main-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Main-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-I; src: local('MathJax_Main Italic'), local('MathJax_Main-Italic')}
@font-face {font-family: MJXc-TeX-main-Ix; src: local('MathJax_Main'); font-style: italic}
@font-face {font-family: MJXc-TeX-main-Iw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Main-Italic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-R; src: local('MathJax_Main'), local('MathJax_Main-Regular')}
@font-face {font-family: MJXc-TeX-main-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Main-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-I; src: local('MathJax_Math Italic'), local('MathJax_Math-Italic')}
@font-face {font-family: MJXc-TeX-math-Ix; src: local('MathJax_Math'); font-style: italic}
@font-face {font-family: MJXc-TeX-math-Iw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Math-Italic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size1-R; src: local('MathJax_Size1'), local('MathJax_Size1-Regular')}
@font-face {font-family: MJXc-TeX-size1-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Size1-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size2-R; src: local('MathJax_Size2'), local('MathJax_Size2-Regular')}
@font-face {font-family: MJXc-TeX-size2-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Size2-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size3-R; src: local('MathJax_Size3'), local('MathJax_Size3-Regular')}
@font-face {font-family: MJXc-TeX-size3-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Size3-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size4-R; src: local('MathJax_Size4'), local('MathJax_Size4-Regular')}
@font-face {font-family: MJXc-TeX-size4-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Size4-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf') format('opentype')}
</style></head>
<body class="post-template"><div id="MathJax_Message" style="display: none;"></div>

    <div class="site-wrapper">

        

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
                <a class="site-nav-logo" href="https://smoolak.com/"><img src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/bigicon-1.png" alt="Smoolak's blog"></a>
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="https://smoolak.com/">Home</a></li>
    <li class="nav-git-server" role="menuitem"><a href="https://smoolak.com/git/">Git server</a></li>
</ul>

    </div>
    <div class="site-nav-right">
        <div class="social-links">
                <a class="social-link social-link-tw" href="https://twitter.com/Smoolak" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"></path></svg>
</a>
        </div>
            <a class="rss-button" href="https://feedly.com/i/subscription/feed/https://smoolak.com/rss/" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg>
</a>
    </div>
</nav>
    </div>
</header>


<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post no-image">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="2019-03-06">6 March 2019</time>
                </section>
                <h1 class="post-full-title">Finding Tiny Faces in the Wild with Generative Adversarial Network</h1>
            </header>


            <section class="post-full-content">
                <div class="kg-card-markdown"><p>Today's post will be discussing the work by <em>Bai et al</em>
 and their paper entitled "Finding Tiny Faces in the Wild with 
Generative Adversarial Network". A detailed description of the deep 
neural network architecture will be given alongside with PyTorch code 
snippets and a full PyTorch implementation of the Generative Adversarial
 Network (GAN).</p>
<h1 id="theidea">The idea</h1>
<p>The main idea behind this work is to use a super-resolution GAN to 
augment a face detector and allow it to better detect faces, especially 
small faces.</p>
<p><img src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/1-2.png" alt="Basic idea"></p>
<h1 id="thearchitecture">The architecture</h1>
<p>The next image is a depiction of the complete architecture found in the original paper. We will explain each part in details.</p>
<p><img src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/2.png" alt="Complete architecture"></p>
<h2 id="detector">Detector</h2>
<p>The pipeline starts with an input image (A) which is sent to a 
detector (B) to extract a large amount of proposals (C). Any face 
detector could be used for this purpose. Therefore, only the GAN network
 will be discussed as it is where most of the contributions of this work
 lay.</p>
<h2 id="generator">Generator</h2>
<p>The proposals (C) are sent iteratively to the generator (D). The 
generator is made of two pieces, an upsampling sub-network and a 
refinement sub-network.</p>
<h3 id="upsamplingsubnetwork">Upsampling sub-network</h3>
<p>The upsampling sub-network is inspired by SRGAN [1]. It contains 8 
residual blocks and 2 fractionally-stride convolutional layer (called 
ConvTranspose2d in PyTorch). The output of this sub-network is a 4x 
super-resolved version of the proposal (input image). The following 
table give the details of the layers:</p>
<table>
<thead>
<tr>
<th>Layer</th>
<th>conv</th>
<th>conv x8</th>
<th>conv</th>
<th>de-conv</th>
<th>de-conv</th>
<th>conv</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel Num.</td>
<td>64</td>
<td>64</td>
<td>64</td>
<td>256</td>
<td>256</td>
<td>3</td>
</tr>
<tr>
<td>Kernel Size</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>4</td>
<td>1</td>
</tr>
<tr>
<td>Stride</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Each convolutional layers (conv) are followed by a batch 
normalization and the ReLU activation function. The 8 residual blocks 
are denoted by "conv x8" and the "de-conv" layers are the 
fractionally-stride convolutional layers that each produce a 2x 
upsampling of the input. The weights in each layer are initialized with a
 zero-mean Gaussian distribution with a standard deviation of 0.02 and 
the biases are initialized to 0.</p>
<p>The residual blocks can be implemented as follow:</p>
<pre class=" language-python"><code class=" language-python" data-language="python"><span class="token keyword">class</span> ResidualBlock<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>    <span class="token keyword">def</span> __init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> downsample<span class="token operator">=</span>None<span class="token punctuation">,</span> init_weights<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        super<span class="token punctuation">(</span>ResidualBlock<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span>stride<span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>bn1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>relu <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>downsample <span class="token operator">=</span> downsample<span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">if</span> init_weights<span class="token punctuation">:</span><span class="token lf">
</span>            self<span class="token punctuation">.</span>_initialize_weights<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>    <span class="token keyword">def</span> forward<span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        residual <span class="token operator">=</span> x<span class="token lf">
</span>        out <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        out <span class="token operator">=</span> self<span class="token punctuation">.</span>bn1<span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token lf">
</span>        out <span class="token operator">=</span> self<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token lf">
</span>        out <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token lf">
</span>        out <span class="token operator">=</span> self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token lf">
</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>downsample<span class="token punctuation">:</span><span class="token lf">
</span>            residual <span class="token operator">=</span> self<span class="token punctuation">.</span>downsample<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        out <span class="token operator">+</span><span class="token operator">=</span> residual<span class="token lf">
</span>        out <span class="token operator">=</span> self<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token lf">
</span>        <span class="token keyword">return</span> out<span class="token lf">
</span><span class="token lf">
</span>    <span class="token keyword">def</span> _initialize_weights<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        <span class="token keyword">for</span> m <span class="token keyword">in</span> self<span class="token punctuation">.</span>modules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>            <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">)</span> <span class="token operator">or</span> isinstance<span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">)</span><span class="token lf">
</span>                <span class="token keyword">if</span> m<span class="token punctuation">.</span>bias <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span><span class="token lf">
</span>                    nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token lf">
</span></code></pre>
<p>As this is a common sub-module for ResNet CNNs, the implementation is inspired by this <a href="https://github.com/yunjey/pytorch-tutorial/blob/master/tutorials/02-intermediate/deep_residual_network/main.py">GitHub repository</a> which is under an MIT license. We added a weight initializer to follow <em>Bai et al</em> description of the implementation.</p>
<p>The upsampling sub-network can then be more easily implemented as follow:</p>
<pre class=" language-python"><code class=" language-python" data-language="python"><span class="token keyword">class</span> G1<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>    <span class="token keyword">def</span> __init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> init_weights<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        super<span class="token punctuation">(</span>G1<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>bn1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>relu1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>            self<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">'residual_block'</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ResidualBlock<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>relu2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>deconv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>ConvTranspose2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>deconv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>ConvTranspose2d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">if</span> init_weights<span class="token punctuation">:</span><span class="token lf">
</span>            self<span class="token punctuation">.</span>_initialize_weights<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>    <span class="token keyword">def</span> forward<span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>bn1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>relu1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>            x <span class="token operator">=</span> self<span class="token punctuation">.</span>__getattr__<span class="token punctuation">(</span><span class="token string">'residual_block'</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>relu2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>deconv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>deconv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">return</span> x<span class="token lf">
</span><span class="token lf">
</span>    <span class="token keyword">def</span> _initialize_weights<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        <span class="token keyword">for</span> m <span class="token keyword">in</span> self<span class="token punctuation">.</span>modules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>            <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">)</span> <span class="token operator">or</span> isinstance<span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">)</span> <span class="token operator">or</span> isinstance<span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ConvTranspose2d<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">)</span><span class="token lf">
</span>                <span class="token keyword">if</span> m<span class="token punctuation">.</span>bias <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span><span class="token lf">
</span>                    nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token lf">
</span></code></pre>
<p>The implementation of a ResidualBlock class allowed us to use a for 
loop to generate the 8 residual blocks comprised into this sub-network. 
The implementation is a straightforward implementation of the previous 
table.</p>
<h3 id="refinementsubnetwork">Refinement sub-network</h3>
<p>The refinement sub-network is almost identical to the upsampling 
sub-network. The fractionally-stride convolutional layers are replaced 
by regular convolution layers and the last convolution is adjusted 
accordingly. The goal of this sub-network is to de-blur the output image
 from the upsampling sub-network while correcting the illumination and 
the hue. The following image show the output of the upsampling 
sub-network on the first row and the output of the refinement 
sub-network on the second row:</p>
<p><img src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/3.png" alt="Refinement sub-network results"></p>
<p>The following table give the details of refinement sub-network layers:</p>
<table>
<thead>
<tr>
<th>Layer</th>
<th>conv</th>
<th>conv x8</th>
<th>conv</th>
<th>conv</th>
<th>conv</th>
<th>conv</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel Num.</td>
<td>64</td>
<td>64</td>
<td>64</td>
<td>256</td>
<td>256</td>
<td>3</td>
</tr>
<tr>
<td>Kernel Size</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>Stride</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>The refinement sub-network can be implemented very similarly to the upsampling sub-network:</p>
<pre class=" language-python"><code class=" language-python" data-language="python"><span class="token keyword">class</span> G2<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>    <span class="token keyword">def</span> __init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> init_weights<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        super<span class="token punctuation">(</span>G2<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>bn1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>relu1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>            self<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">'residual_block'</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ResidualBlock<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>relu2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>bn3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>relu3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>bn4 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>relu4 <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">if</span> init_weights<span class="token punctuation">:</span><span class="token lf">
</span>            self<span class="token punctuation">.</span>_initialize_weights<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>    <span class="token keyword">def</span> forward<span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>bn1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>relu1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>            x <span class="token operator">=</span> self<span class="token punctuation">.</span>__getattr__<span class="token punctuation">(</span><span class="token string">'residual_block'</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>relu2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>bn3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>relu3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>bn4<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>relu4<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">return</span> x<span class="token lf">
</span><span class="token lf">
</span>    <span class="token keyword">def</span> _initialize_weights<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        <span class="token keyword">for</span> m <span class="token keyword">in</span> self<span class="token punctuation">.</span>modules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>            <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">)</span> <span class="token operator">or</span> isinstance<span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">)</span> <span class="token operator">or</span> isinstance<span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ConvTranspose2d<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">)</span><span class="token lf">
</span>                <span class="token keyword">if</span> m<span class="token punctuation">.</span>bias <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span><span class="token lf">
</span>                    nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token lf">
</span></code></pre>
<p>Then both sub-networks can be attach to each other to form the complete generator:</p>
<pre class=" language-python"><code class=" language-python" data-language="python"><span class="token keyword">class</span> G<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>    <span class="token keyword">def</span> __init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> init_weights<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        super<span class="token punctuation">(</span>G<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>G1 <span class="token operator">=</span> G1<span class="token punctuation">(</span>init_weights<span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>G2 <span class="token operator">=</span> G2<span class="token punctuation">(</span>init_weights<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>    <span class="token keyword">def</span> forward<span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        g1 <span class="token operator">=</span> self<span class="token punctuation">.</span>G1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        g2 <span class="token operator">=</span> self<span class="token punctuation">.</span>G2<span class="token punctuation">(</span>g1<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">return</span> g1<span class="token punctuation">,</span>g2<span class="token lf">
</span></code></pre>
<p>Note that the outputs of both generators are returned as they will be used in the loss functions.</p>
<h2 id="discriminator">Discriminator</h2>
<p>The last step of the pipeline is the discriminator (E) which receive 
the super-resolved and refined output from the generator (D). The 
discriminator (E) is a modified VGG19 from which all fully connected 
(fc) layers have been removed and replaced by two parallel fc layers 
followed by the sigmoid activation function. The first fc layer is used 
to obtain the probability of the input being a super-resolved image or 
an original high resolution image. The second fc layer is similarly 
giving the probability of the image being a face or not. Note that the 
last max-pooling operation have also been removed to avoid too much 
down-sampling. The model is pre-trained on ImageNet and the new fc 
layers are initialized following a zero-mean Gaussian distribution with a
 standard deviation 0.1 and all biases are set to 0. The following table
 give the details of the layers:</p>
<table>
<thead>
<tr>
<th>Layer</th>
<th>conv</th>
<th>conv</th>
<th>conv</th>
<th>conv</th>
<th>conv</th>
<th>fc</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kernel Num.</td>
<td>64</td>
<td>128</td>
<td>256</td>
<td>512</td>
<td>512</td>
<td>2</td>
</tr>
<tr>
<td>Kernel Size</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>-</td>
</tr>
<tr>
<td>Stride</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>This VGG19 can be implemented as follow:</p>
<pre class=" language-python"><code class=" language-python" data-language="python"><span class="token keyword">class</span> VGG19<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>    <span class="token keyword">def</span> __init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> init_weights<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        super<span class="token punctuation">(</span>VGG19<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        layers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token lf">
</span>        in_channels <span class="token operator">=</span> <span class="token number">3</span><span class="token lf">
</span>        <span class="token keyword">for</span> v <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token lf">
</span>            <span class="token keyword">if</span> v <span class="token operator">==</span> <span class="token string">'M'</span><span class="token punctuation">:</span><span class="token lf">
</span>                layers <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">[</span>nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token lf">
</span>            <span class="token keyword">else</span><span class="token punctuation">:</span><span class="token lf">
</span>                conv2d <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> v<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span>                layers <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">[</span>conv2d<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token lf">
</span>                in_channels <span class="token operator">=</span> v<span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>features <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>layers<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>fcgan <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">2048</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>fcclc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">2048</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">if</span> init_weights<span class="token punctuation">:</span><span class="token lf">
</span>            self<span class="token punctuation">.</span>_initialize_weights<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        self<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>model_zoo<span class="token punctuation">.</span>load_url<span class="token punctuation">(</span><span class="token string">"<a class="token url-link" href="https://download.pytorch.org/models/vgg19-dcbb9e9d.pth">https://download.pytorch.org/models/vgg19-dcbb9e9d.pth</a>"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strict<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>    <span class="token keyword">def</span> forward<span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>features<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        gan <span class="token operator">=</span> self<span class="token punctuation">.</span>fcgan<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span>        clc <span class="token operator">=</span> self<span class="token punctuation">.</span>fcclc<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token keyword">return</span> gan<span class="token punctuation">,</span>clc<span class="token lf">
</span><span class="token lf">
</span>    <span class="token keyword">def</span> _initialize_weights<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        <span class="token keyword">for</span> m <span class="token keyword">in</span> self<span class="token punctuation">.</span>modules<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>            <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>kaiming_normal_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'fan_out'</span><span class="token punctuation">,</span> nonlinearity<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token lf">
</span>                <span class="token keyword">if</span> m<span class="token punctuation">.</span>bias <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span><span class="token lf">
</span>                    nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token lf">
</span>            <span class="token keyword">elif</span> isinstance<span class="token punctuation">(</span>m<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token lf">
</span>                nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token lf">
</span></code></pre>
<p>The core of this implementation is based on the <a href="https://github.com/pytorch/vision/blob/master/torchvision/models/vgg.py">PyTorch vision implementation</a> to allow us to easily load the ImageNet weights from the PyTorch website.</p>
<h1 id="lossfunctions">Loss functions</h1>
<p>In order to train the architecture, we need to discuss the loss 
functions employed by the network. This work is using 3 base loss 
functions which are used as bulding blocks to build the objective loss 
function used to train the full network.</p>
<h2 id="pixelwiseloss">Pixel-wise loss</h2>
<p>This loss is also known as the MSE loss and is often used for super-resolution.</p>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-1-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;munderover&gt;&lt;mo movablelimits=&quot;false&quot;&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/munderover&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mo symmetric=&quot;true&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;/mrow&gt;&lt;mo symmetric=&quot;true&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mo symmetric=&quot;true&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;/mrow&gt;&lt;mo symmetric=&quot;true&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-1" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-2" class="mjx-mrow"><span id="MJXc-Node-3" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-4" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-5" class="mjx-texatom" style=""><span id="MJXc-Node-6" class="mjx-mrow"><span id="MJXc-Node-7" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.081em;">M</span></span><span id="MJXc-Node-8" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em; padding-right: 0.032em;">S</span></span><span id="MJXc-Node-9" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.026em;">E</span></span></span></span></span></span><span id="MJXc-Node-10" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em;">(</span></span><span id="MJXc-Node-11" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span><span id="MJXc-Node-12" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em;">)</span></span><span id="MJXc-Node-13" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-14" class="mjx-mfrac MJXc-space3"><span class="mjx-box MJXc-stacked" style="width: 1.088em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 1.088em; top: -1.368em;"><span id="MJXc-Node-15" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span><span class="mjx-denominator" style="width: 1.088em; bottom: -0.711em;"><span id="MJXc-Node-16" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.085em;">N</span></span></span><span style="border-bottom: 1.5px solid; top: -0.28em; width: 1.088em;" class="mjx-line"></span></span><span style="height: 2.078em; vertical-align: -0.711em;" class="mjx-vsize"></span></span><span id="MJXc-Node-17" class="mjx-munderover MJXc-space1"><span class="mjx-itable"><span class="mjx-row"><span class="mjx-cell"><span class="mjx-stack"><span class="mjx-over" style="font-size: 70.7%; padding-bottom: 0.258em; padding-top: 0.141em; padding-left: 0.577em;"><span id="MJXc-Node-24" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.085em;">N</span></span></span><span class="mjx-op"><span id="MJXc-Node-18" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.726em; padding-bottom: 0.726em;">∑</span></span></span></span></span></span><span class="mjx-row"><span class="mjx-under" style="font-size: 70.7%; padding-top: 0.236em; padding-bottom: 0.141em; padding-left: 0.21em;"><span id="MJXc-Node-19" class="mjx-texatom" style=""><span id="MJXc-Node-20" class="mjx-mrow"><span id="MJXc-Node-21" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span><span id="MJXc-Node-22" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-23" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span></span></span></span></span></span><span id="MJXc-Node-25" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-26" class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.209em; padding-bottom: 1.209em;">(</span></span><span id="MJXc-Node-27" class="mjx-mrow"><span id="MJXc-Node-28" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-29" class="mjx-mrow"><span id="MJXc-Node-30" class="mjx-mo" style="vertical-align: -0.162em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-bottom: -0.725em;">∥</span><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-top: -0.725em;">∥</span></span></span><span id="MJXc-Node-31" class="mjx-mrow"><span id="MJXc-Node-32" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-33" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-34" class="mjx-texatom" style=""><span id="MJXc-Node-35" class="mjx-mrow"><span id="MJXc-Node-36" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-37" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-38" class="mjx-texatom" style=""><span id="MJXc-Node-39" class="mjx-mrow"><span id="MJXc-Node-40" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-41" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span><span class="mjx-sub" style="vertical-align: -0.337em; padding-right: 0.05em;"><span id="MJXc-Node-42" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-43" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-44" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-45" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-46" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-48" class="mjx-texatom" style=""><span id="MJXc-Node-49" class="mjx-mrow"><span id="MJXc-Node-50" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span><span id="MJXc-Node-51" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-47" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-52" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span><span id="MJXc-Node-53" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-54" class="mjx-msubsup MJXc-space2"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-55" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-57" class="mjx-texatom" style=""><span id="MJXc-Node-58" class="mjx-mrow"><span id="MJXc-Node-59" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-60" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-56" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span></span><span id="MJXc-Node-61" class="mjx-mo" style="vertical-align: -0.162em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-bottom: -0.725em;">∥</span><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-top: -0.725em;">∥</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.939em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-62" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">2</span></span></span></span><span id="MJXc-Node-63" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">+</span></span><span id="MJXc-Node-64" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-65" class="mjx-mrow"><span id="MJXc-Node-66" class="mjx-mo" style="vertical-align: -0.4em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-bottom: -0.25em;">∥</span><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-top: -0.25em;">∥</span></span></span><span id="MJXc-Node-67" class="mjx-mrow"><span id="MJXc-Node-68" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-69" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-70" class="mjx-texatom" style=""><span id="MJXc-Node-71" class="mjx-mrow"><span id="MJXc-Node-72" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-73" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">2</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-74" class="mjx-texatom" style=""><span id="MJXc-Node-75" class="mjx-mrow"><span id="MJXc-Node-76" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-77" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span><span class="mjx-sub" style="vertical-align: -0.337em; padding-right: 0.05em;"><span id="MJXc-Node-78" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">2</span></span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-79" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-80" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.927em; padding-bottom: 0.927em;">(</span></span><span id="MJXc-Node-81" class="mjx-mrow"><span id="MJXc-Node-82" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-83" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-84" class="mjx-texatom" style=""><span id="MJXc-Node-85" class="mjx-mrow"><span id="MJXc-Node-86" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-87" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-88" class="mjx-texatom" style=""><span id="MJXc-Node-89" class="mjx-mrow"><span id="MJXc-Node-90" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-91" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span><span class="mjx-sub" style="vertical-align: -0.337em; padding-right: 0.05em;"><span id="MJXc-Node-92" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-93" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-94" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-95" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-96" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-98" class="mjx-texatom" style=""><span id="MJXc-Node-99" class="mjx-mrow"><span id="MJXc-Node-100" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span><span id="MJXc-Node-101" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-97" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-102" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-103" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.927em; padding-bottom: 0.927em;">)</span></span></span><span id="MJXc-Node-104" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-105" class="mjx-msubsup MJXc-space2"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-106" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-108" class="mjx-texatom" style=""><span id="MJXc-Node-109" class="mjx-mrow"><span id="MJXc-Node-110" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-111" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-107" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span></span><span id="MJXc-Node-112" class="mjx-mo" style="vertical-align: -0.4em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-bottom: -0.25em;">∥</span><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-top: -0.25em;">∥</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 1.276em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-113" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">2</span></span></span></span></span><span id="MJXc-Node-114" class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.209em; padding-bottom: 1.209em;">)</span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mrow class="MJX-TeXAtom-ORD"><mi>M</mi><mi>S</mi><mi>E</mi></mrow></msub><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo movablelimits="false">∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mrow><mo>(</mo><mrow><msup><mrow><mo symmetric="true">‖</mo><mrow><msub><mi>G</mi><mrow class="MJX-TeXAtom-ORD"><msub><mn>1</mn><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mn>1</mn></msub></mrow></msub></mrow></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>L</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow><mo>−</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>H</mi><mi>R</mi></mrow></msubsup></mrow><mo symmetric="true">‖</mo></mrow><mn>2</mn></msup><mo>+</mo><msup><mrow><mo symmetric="true">‖</mo><mrow><msub><mi>G</mi><mrow class="MJX-TeXAtom-ORD"><msub><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mn>2</mn></msub></mrow></msub></mrow></msub><mrow><mo>(</mo><mrow><msub><mi>G</mi><mrow class="MJX-TeXAtom-ORD"><msub><mn>1</mn><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mn>1</mn></msub></mrow></msub></mrow></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>L</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>−</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>H</mi><mi>R</mi></mrow></msubsup></mrow><mo symmetric="true">‖</mo></mrow><mn>2</mn></msup></mrow><mo>)</mo></mrow></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-1"> L_{MSE}(w) = \frac{1}{N}\sum\limits_{i = 1}^N \left(\left\lVert G_{1_{w_1}}\left(I_i^{LR}\right) - I_i^{HR}\right\rVert^2 + \left\lVert G_{2_{w_2}}\left(G_{1_{w_1}}\left(I_i^{LR}\right)\right) - I_i^{HR}\right\rVert^2 \right) </script></p>
<h2 id="adversarialloss">Adversarial loss</h2>
<p>The adversarial loss is commonly used in super-resolution GANs as it 
allow the network to generate photo-realistic results by introducing the
 discriminator in the learning process.</p>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-2-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;munderover&gt;&lt;mo movablelimits=&quot;false&quot;&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/munderover&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-115" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-116" class="mjx-mrow"><span id="MJXc-Node-117" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-118" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.219em; padding-right: 0.071em;"><span id="MJXc-Node-119" class="mjx-texatom" style=""><span id="MJXc-Node-120" class="mjx-mrow"><span id="MJXc-Node-121" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">a</span></span><span id="MJXc-Node-122" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em; padding-right: 0.003em;">d</span></span><span id="MJXc-Node-123" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">v</span></span></span></span></span></span><span id="MJXc-Node-124" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-125" class="mjx-mfrac MJXc-space3"><span class="mjx-box MJXc-stacked" style="width: 1.088em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 1.088em; top: -1.368em;"><span id="MJXc-Node-126" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span><span class="mjx-denominator" style="width: 1.088em; bottom: -0.711em;"><span id="MJXc-Node-127" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.085em;">N</span></span></span><span style="border-bottom: 1.5px solid; top: -0.28em; width: 1.088em;" class="mjx-line"></span></span><span style="height: 2.078em; vertical-align: -0.711em;" class="mjx-vsize"></span></span><span id="MJXc-Node-128" class="mjx-munderover MJXc-space1"><span class="mjx-itable"><span class="mjx-row"><span class="mjx-cell"><span class="mjx-stack"><span class="mjx-over" style="font-size: 70.7%; padding-bottom: 0.258em; padding-top: 0.141em; padding-left: 0.577em;"><span id="MJXc-Node-135" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.085em;">N</span></span></span><span class="mjx-op"><span id="MJXc-Node-129" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.726em; padding-bottom: 0.726em;">∑</span></span></span></span></span></span><span class="mjx-row"><span class="mjx-under" style="font-size: 70.7%; padding-top: 0.236em; padding-bottom: 0.141em; padding-left: 0.21em;"><span id="MJXc-Node-130" class="mjx-texatom" style=""><span id="MJXc-Node-131" class="mjx-mrow"><span id="MJXc-Node-132" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span><span id="MJXc-Node-133" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-134" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span></span></span></span></span></span><span id="MJXc-Node-136" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-137" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-138" class="mjx-mrow"><span id="MJXc-Node-139" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.404em; padding-bottom: 0.565em;">log</span></span><span id="MJXc-Node-140" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-141" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-142" class="mjx-mrow"><span id="MJXc-Node-143" class="mjx-mrow"><span id="MJXc-Node-144" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-145" class="mjx-mrow"><span id="MJXc-Node-146" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span><span id="MJXc-Node-147" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-148" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-149" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-150" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span><span id="MJXc-Node-151" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-152" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-153" class="mjx-mrow"><span id="MJXc-Node-154" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-155" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-156" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span></span><span id="MJXc-Node-157" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-158" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-159" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-160" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-162" class="mjx-texatom" style=""><span id="MJXc-Node-163" class="mjx-mrow"><span id="MJXc-Node-164" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span><span id="MJXc-Node-165" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-161" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-166" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-167" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-168" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span><span id="MJXc-Node-169" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">+</span></span><span id="MJXc-Node-170" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.404em; padding-bottom: 0.565em;">log</span></span><span id="MJXc-Node-171" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-172" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-173" class="mjx-mrow"><span id="MJXc-Node-174" class="mjx-mrow"><span id="MJXc-Node-175" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-176" class="mjx-mrow"><span id="MJXc-Node-177" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-178" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-179" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span><span id="MJXc-Node-180" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-181" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-182" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-183" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-185" class="mjx-texatom" style=""><span id="MJXc-Node-186" class="mjx-mrow"><span id="MJXc-Node-187" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-188" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-184" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-189" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-190" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span></span><span id="MJXc-Node-191" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi><mi>d</mi><mi>v</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo movablelimits="false">∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mrow><mo>(</mo><mrow><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mrow><mo>(</mo><mrow><mn>1</mn><mo>−</mo><msub><mi>D</mi><mi>θ</mi></msub><mrow><mo>(</mo><mrow><msub><mi>G</mi><mi>w</mi></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>L</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow><mo>+</mo><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mrow><mo>(</mo><mrow><msub><mi>D</mi><mi>θ</mi></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>H</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow></mrow><mo>)</mo></mrow></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-2"> L_{adv} = \frac{1}{N}\sum\limits_{i = 1}^N \left(\log{\left(1 - D_\theta\left(G_w\left(I_i^{LR}\right)\right)\right)} + \log{\left(D_\theta\left(I_i^{HR}\right)\right)}\right) </script></p>
<h2 id="classificationloss">Classification loss</h2>
<p>The classification loss is introduced to allow the network to classify the images as face or non-faces.</p>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-3-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;munderover&gt;&lt;mo movablelimits=&quot;false&quot;&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/munderover&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-192" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-193" class="mjx-mrow"><span id="MJXc-Node-194" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-195" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.219em; padding-right: 0.071em;"><span id="MJXc-Node-196" class="mjx-texatom" style=""><span id="MJXc-Node-197" class="mjx-mrow"><span id="MJXc-Node-198" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">c</span></span><span id="MJXc-Node-199" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">l</span></span><span id="MJXc-Node-200" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">c</span></span></span></span></span></span><span id="MJXc-Node-201" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-202" class="mjx-mfrac MJXc-space3"><span class="mjx-box MJXc-stacked" style="width: 1.088em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 1.088em; top: -1.368em;"><span id="MJXc-Node-203" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span><span class="mjx-denominator" style="width: 1.088em; bottom: -0.711em;"><span id="MJXc-Node-204" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.085em;">N</span></span></span><span style="border-bottom: 1.5px solid; top: -0.28em; width: 1.088em;" class="mjx-line"></span></span><span style="height: 2.078em; vertical-align: -0.711em;" class="mjx-vsize"></span></span><span id="MJXc-Node-205" class="mjx-munderover MJXc-space1"><span class="mjx-itable"><span class="mjx-row"><span class="mjx-cell"><span class="mjx-stack"><span class="mjx-over" style="font-size: 70.7%; padding-bottom: 0.258em; padding-top: 0.141em; padding-left: 0.577em;"><span id="MJXc-Node-212" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.085em;">N</span></span></span><span class="mjx-op"><span id="MJXc-Node-206" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.726em; padding-bottom: 0.726em;">∑</span></span></span></span></span></span><span class="mjx-row"><span class="mjx-under" style="font-size: 70.7%; padding-top: 0.236em; padding-bottom: 0.141em; padding-left: 0.21em;"><span id="MJXc-Node-207" class="mjx-texatom" style=""><span id="MJXc-Node-208" class="mjx-mrow"><span id="MJXc-Node-209" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span><span id="MJXc-Node-210" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-211" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span></span></span></span></span></span><span id="MJXc-Node-213" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-214" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-215" class="mjx-mrow"><span id="MJXc-Node-216" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.404em; padding-bottom: 0.565em;">log</span></span><span id="MJXc-Node-217" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-218" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-219" class="mjx-mrow"><span id="MJXc-Node-220" class="mjx-mrow"><span id="MJXc-Node-221" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-222" class="mjx-mrow"><span id="MJXc-Node-223" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-224" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.485em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-225" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span><span id="MJXc-Node-226" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-227" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-228" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-229" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span><span id="MJXc-Node-230" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-231" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-232" class="mjx-mrow"><span id="MJXc-Node-233" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-234" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-235" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span></span><span id="MJXc-Node-236" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-237" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-238" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-239" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-241" class="mjx-texatom" style=""><span id="MJXc-Node-242" class="mjx-mrow"><span id="MJXc-Node-243" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span><span id="MJXc-Node-244" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-240" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-245" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-246" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-247" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span><span id="MJXc-Node-248" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">+</span></span><span id="MJXc-Node-249" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.404em; padding-bottom: 0.565em;">log</span></span><span id="MJXc-Node-250" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-251" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-252" class="mjx-mrow"><span id="MJXc-Node-253" class="mjx-mrow"><span id="MJXc-Node-254" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-255" class="mjx-mrow"><span id="MJXc-Node-256" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-257" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.485em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-258" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span><span id="MJXc-Node-259" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-260" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-261" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-262" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span><span id="MJXc-Node-263" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-264" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-265" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-266" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-268" class="mjx-texatom" style=""><span id="MJXc-Node-269" class="mjx-mrow"><span id="MJXc-Node-270" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-271" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-267" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-272" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-273" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span></span><span id="MJXc-Node-274" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mrow class="MJX-TeXAtom-ORD"><mi>c</mi><mi>l</mi><mi>c</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo movablelimits="false">∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mrow><mo>(</mo><mrow><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mrow><mo>(</mo><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mi>D</mi><mi>θ</mi></msub><mrow><mo>(</mo><mrow><msub><mi>G</mi><mi>w</mi></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>L</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow><mo>+</mo><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mrow><mo>(</mo><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mi>D</mi><mi>θ</mi></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>H</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow></mrow><mo>)</mo></mrow></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-3"> L_{clc} = \frac{1}{N}\sum\limits_{i = 1}^N \left(\log{\left(y_i - D_\theta\left(G_w\left(I_i^{LR}\right)\right)\right)} + \log{\left(y_i - D_\theta\left(I_i^{HR}\right)\right)}\right) </script></p>
<h2 id="combinedloss">Combined loss</h2>
<p>The previous loss are combined into two loss, one for the generator and one for the discriminator.</p>
<h3 id="generatorloss">Generator loss</h3>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-4-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right center left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0 thickmathspace&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;munder&gt;&lt;mo form=&quot;prefix&quot;&gt;min&lt;/mo&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/munder&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;munderover&gt;&lt;mo movablelimits=&quot;false&quot;&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/munderover&gt;&lt;/mtd&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mo symmetric=&quot;true&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;/mrow&gt;&lt;mo symmetric=&quot;true&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mo symmetric=&quot;true&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;/mrow&gt;&lt;mo symmetric=&quot;true&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-275" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-276" class="mjx-mrow"><span id="MJXc-Node-277" class="mjx-mtable" style="vertical-align: -3.421em; padding: 0px 0.167em;"><span class="mjx-table"><span id="MJXc-Node-278" class="mjx-mtr" style="height: 3.181em;"><span id="MJXc-Node-279" class="mjx-mtd" style="padding: 0px; text-align: right; width: 4.606em;"><span id="MJXc-Node-280" class="mjx-mrow"><span id="MJXc-Node-281" class="mjx-munderover"><span class="mjx-itable"><span class="mjx-row"><span class="mjx-cell"><span class="mjx-op"><span id="MJXc-Node-282" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">min</span></span></span></span></span><span class="mjx-row"><span class="mjx-under" style="font-size: 70.7%; padding-top: 0.236em; padding-bottom: 0.141em; padding-left: 0.821em;"><span id="MJXc-Node-283" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span></span></span></span><span id="MJXc-Node-284" class="mjx-mfrac MJXc-space1"><span class="mjx-box MJXc-stacked" style="width: 1.088em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 1.088em; top: -1.368em;"><span id="MJXc-Node-285" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span><span class="mjx-denominator" style="width: 1.088em; bottom: -0.711em;"><span id="MJXc-Node-286" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.085em;">N</span></span></span><span style="border-bottom: 1.5px solid; top: -0.28em; width: 1.088em;" class="mjx-line"></span></span><span style="height: 2.078em; vertical-align: -0.711em;" class="mjx-vsize"></span></span><span id="MJXc-Node-287" class="mjx-munderover MJXc-space1"><span class="mjx-itable"><span class="mjx-row"><span class="mjx-cell"><span class="mjx-stack"><span class="mjx-over" style="font-size: 70.7%; padding-bottom: 0.258em; padding-top: 0.141em; padding-left: 0.577em;"><span id="MJXc-Node-294" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.085em;">N</span></span></span><span class="mjx-op"><span id="MJXc-Node-288" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.726em; padding-bottom: 0.726em;">∑</span></span></span></span></span></span><span class="mjx-row"><span class="mjx-under" style="font-size: 70.7%; padding-top: 0.236em; padding-bottom: 0.141em; padding-left: 0.21em;"><span id="MJXc-Node-289" class="mjx-texatom" style=""><span id="MJXc-Node-290" class="mjx-mrow"><span id="MJXc-Node-291" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span><span id="MJXc-Node-292" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-293" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span></span></span></span></span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-295" class="mjx-mtd" style="padding: 0px 0.139em 0px 0px; width: 0.778em;"><span id="MJXc-Node-296" class="mjx-mrow" style="margin-top: 0.776em;"><span class="mjx-strut"></span></span></span><span id="MJXc-Node-297" class="mjx-mtd" style="padding: 0px 0px 0px 0.139em; text-align: left; width: 23.742em;"><span id="MJXc-Node-298" class="mjx-mrow" style="margin-top: 0.776em;"><span id="MJXc-Node-299" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">α</span></span><span id="MJXc-Node-300" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.404em; padding-bottom: 0.565em;">log</span></span><span id="MJXc-Node-301" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-302" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-303" class="mjx-mrow"><span id="MJXc-Node-304" class="mjx-mrow"><span id="MJXc-Node-305" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-306" class="mjx-mrow"><span id="MJXc-Node-307" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span><span id="MJXc-Node-308" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-309" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-310" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-311" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span><span id="MJXc-Node-312" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-313" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-314" class="mjx-mrow"><span id="MJXc-Node-315" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-316" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-317" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span></span><span id="MJXc-Node-318" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-319" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-320" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-321" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-323" class="mjx-texatom" style=""><span id="MJXc-Node-324" class="mjx-mrow"><span id="MJXc-Node-325" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span><span id="MJXc-Node-326" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-322" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-327" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-328" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-329" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-330" class="mjx-mtr" style="height: 2.749em;"><span id="MJXc-Node-331" class="mjx-mtd" style="padding: 0.15em 0px 0px; text-align: right;"><span id="MJXc-Node-332" class="mjx-mrow" style="margin-top: 0.475em;"><span id="MJXc-Node-333" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.28em; padding-bottom: 0.324em;">&nbsp;</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-334" class="mjx-mtd" style="padding: 0.15em 0.139em 0px 0px;"><span id="MJXc-Node-335" class="mjx-mrow" style="margin-top: 0.475em;"><span id="MJXc-Node-336" class="mjx-mi"></span><span id="MJXc-Node-337" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">+</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-338" class="mjx-mtd" style="padding: 0.15em 0px 0px 0.139em; text-align: left;"><span id="MJXc-Node-339" class="mjx-mrow"><span id="MJXc-Node-340" class="mjx-mrow"><span id="MJXc-Node-341" class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.209em; padding-bottom: 1.209em;">(</span></span><span id="MJXc-Node-342" class="mjx-mrow"><span id="MJXc-Node-343" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-344" class="mjx-mrow"><span id="MJXc-Node-345" class="mjx-mo" style="vertical-align: -0.162em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-bottom: -0.725em;">∥</span><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-top: -0.725em;">∥</span></span></span><span id="MJXc-Node-346" class="mjx-mrow"><span id="MJXc-Node-347" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-348" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-349" class="mjx-texatom" style=""><span id="MJXc-Node-350" class="mjx-mrow"><span id="MJXc-Node-351" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-352" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-353" class="mjx-texatom" style=""><span id="MJXc-Node-354" class="mjx-mrow"><span id="MJXc-Node-355" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-356" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span><span class="mjx-sub" style="vertical-align: -0.337em; padding-right: 0.05em;"><span id="MJXc-Node-357" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-358" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-359" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-360" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-361" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-363" class="mjx-texatom" style=""><span id="MJXc-Node-364" class="mjx-mrow"><span id="MJXc-Node-365" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span><span id="MJXc-Node-366" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-362" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-367" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span><span id="MJXc-Node-368" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-369" class="mjx-msubsup MJXc-space2"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-370" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-372" class="mjx-texatom" style=""><span id="MJXc-Node-373" class="mjx-mrow"><span id="MJXc-Node-374" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-375" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-371" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span></span><span id="MJXc-Node-376" class="mjx-mo" style="vertical-align: -0.162em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-bottom: -0.725em;">∥</span><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-top: -0.725em;">∥</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.939em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-377" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">2</span></span></span></span><span id="MJXc-Node-378" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">+</span></span><span id="MJXc-Node-379" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-380" class="mjx-mrow"><span id="MJXc-Node-381" class="mjx-mo" style="vertical-align: -0.4em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-bottom: -0.25em;">∥</span><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-top: -0.25em;">∥</span></span></span><span id="MJXc-Node-382" class="mjx-mrow"><span id="MJXc-Node-383" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-384" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-385" class="mjx-texatom" style=""><span id="MJXc-Node-386" class="mjx-mrow"><span id="MJXc-Node-387" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-388" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">2</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-389" class="mjx-texatom" style=""><span id="MJXc-Node-390" class="mjx-mrow"><span id="MJXc-Node-391" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-392" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span><span class="mjx-sub" style="vertical-align: -0.337em; padding-right: 0.05em;"><span id="MJXc-Node-393" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">2</span></span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-394" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-395" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.927em; padding-bottom: 0.927em;">(</span></span><span id="MJXc-Node-396" class="mjx-mrow"><span id="MJXc-Node-397" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-398" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-399" class="mjx-texatom" style=""><span id="MJXc-Node-400" class="mjx-mrow"><span id="MJXc-Node-401" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-402" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-403" class="mjx-texatom" style=""><span id="MJXc-Node-404" class="mjx-mrow"><span id="MJXc-Node-405" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-406" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span><span class="mjx-sub" style="vertical-align: -0.337em; padding-right: 0.05em;"><span id="MJXc-Node-407" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-408" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-409" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-410" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-411" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-413" class="mjx-texatom" style=""><span id="MJXc-Node-414" class="mjx-mrow"><span id="MJXc-Node-415" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span><span id="MJXc-Node-416" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-412" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-417" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-418" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.927em; padding-bottom: 0.927em;">)</span></span></span><span id="MJXc-Node-419" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-420" class="mjx-msubsup MJXc-space2"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-421" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-423" class="mjx-texatom" style=""><span id="MJXc-Node-424" class="mjx-mrow"><span id="MJXc-Node-425" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-426" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-422" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span></span><span id="MJXc-Node-427" class="mjx-mo" style="vertical-align: -0.4em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-bottom: -0.25em;">∥</span><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.444em; padding-bottom: 0.605em; margin-top: -0.25em;">∥</span></span></span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 1.276em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-428" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">2</span></span></span></span></span><span id="MJXc-Node-429" class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.209em; padding-bottom: 1.209em;">)</span></span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-430" class="mjx-mtr" style="height: 1.411em;"><span id="MJXc-Node-431" class="mjx-mtd" style="padding: 0.15em 0px 0px; text-align: right;"><span id="MJXc-Node-432" class="mjx-mrow" style="margin-top: -0.113em;"><span id="MJXc-Node-433" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.28em; padding-bottom: 0.324em;">&nbsp;</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-434" class="mjx-mtd" style="padding: 0.15em 0.139em 0px 0px;"><span id="MJXc-Node-435" class="mjx-mrow" style="margin-top: -0.113em;"><span id="MJXc-Node-436" class="mjx-mi"></span><span id="MJXc-Node-437" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">+</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-438" class="mjx-mtd" style="padding: 0.15em 0px 0px 0.139em; text-align: left;"><span id="MJXc-Node-439" class="mjx-mrow" style="margin-top: -0.113em;"><span id="MJXc-Node-440" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.485em; padding-right: 0.007em;">β</span></span><span id="MJXc-Node-441" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.404em; padding-bottom: 0.565em;">log</span></span><span id="MJXc-Node-442" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-443" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-444" class="mjx-mrow"><span id="MJXc-Node-445" class="mjx-mrow"><span id="MJXc-Node-446" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-447" class="mjx-mrow"><span id="MJXc-Node-448" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-449" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.485em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-450" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span><span id="MJXc-Node-451" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-452" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-453" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-454" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span><span id="MJXc-Node-455" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-456" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-457" class="mjx-mrow"><span id="MJXc-Node-458" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-459" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-460" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span></span><span id="MJXc-Node-461" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-462" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-463" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-464" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-466" class="mjx-texatom" style=""><span id="MJXc-Node-467" class="mjx-mrow"><span id="MJXc-Node-468" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span><span id="MJXc-Node-469" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-465" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-470" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-471" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-472" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right center left" rowspacing="3pt" columnspacing="0 thickmathspace" displaystyle="true"><mtr><mtd><munder><mo form="prefix">min</mo><mi>w</mi></munder><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo movablelimits="false">∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover></mtd><mtd></mtd><mtd><mi>α</mi><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mrow><mo>(</mo><mrow><mn>1</mn><mo>−</mo><msub><mi>D</mi><mi>θ</mi></msub><mrow><mo>(</mo><mrow><msub><mi>G</mi><mi>w</mi></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>L</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd><mtext>&nbsp;</mtext></mtd><mtd><mi></mi><mo>+</mo></mtd><mtd><mrow><mo>(</mo><mrow><msup><mrow><mo symmetric="true">‖</mo><mrow><msub><mi>G</mi><mrow class="MJX-TeXAtom-ORD"><msub><mn>1</mn><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mn>1</mn></msub></mrow></msub></mrow></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>L</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow><mo>−</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>H</mi><mi>R</mi></mrow></msubsup></mrow><mo symmetric="true">‖</mo></mrow><mn>2</mn></msup><mo>+</mo><msup><mrow><mo symmetric="true">‖</mo><mrow><msub><mi>G</mi><mrow class="MJX-TeXAtom-ORD"><msub><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mn>2</mn></msub></mrow></msub></mrow></msub><mrow><mo>(</mo><mrow><msub><mi>G</mi><mrow class="MJX-TeXAtom-ORD"><msub><mn>1</mn><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mn>1</mn></msub></mrow></msub></mrow></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>L</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>−</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>H</mi><mi>R</mi></mrow></msubsup></mrow><mo symmetric="true">‖</mo></mrow><mn>2</mn></msup></mrow><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mtext>&nbsp;</mtext></mtd><mtd><mi></mi><mo>+</mo></mtd><mtd><mi>β</mi><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mrow><mo>(</mo><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mi>D</mi><mi>θ</mi></msub><mrow><mo>(</mo><mrow><msub><mi>G</mi><mi>w</mi></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>L</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow></mtd></mtr></mtable></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-4">\begin{eqnarray}\min\limits_w\frac{1}{N}\sum\limits_{i = 1}^N &&\alpha\log{\left(1 - D_\theta\left(G_w\left(I_i^{LR}\right)\right)\right)} \\\ &+& \left(\left\lVert G_{1_{w_1}}\left(I_i^{LR}\right) - I_i^{HR}\right\rVert^2 + \left\lVert G_{2_{w_2}}\left(G_{1_{w_1}}\left(I_i^{LR}\right)\right) - I_i^{HR}\right\rVert^2 \right) \\\ &+& \beta\log{\left(y_i - D_\theta\left(G_w\left(I_i^{LR}\right)\right)\right)}\end{eqnarray}</script></p>
<p>Equivalent code:</p>
<pre class=" language-python"><code class=" language-python" data-language="python">loss_G <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>ones <span class="token operator">-</span> SR_gan <span class="token operator">+</span> eps<span class="token punctuation">)</span><span class="token punctuation">,</span> alpha<span class="token punctuation">)</span> \<span class="token lf">
</span><span class="token operator">+</span> F<span class="token punctuation">.</span>mse_loss<span class="token punctuation">(</span>SR_g1<span class="token punctuation">,</span> HR<span class="token punctuation">)</span> <span class="token operator">+</span> F<span class="token punctuation">.</span>mse_loss<span class="token punctuation">(</span>SR_g2<span class="token punctuation">,</span> HR<span class="token punctuation">)</span> \<span class="token lf">
</span><span class="token operator">+</span> torch<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>label <span class="token operator">-</span> SR_clc <span class="token operator">+</span> eps<span class="token punctuation">)</span><span class="token punctuation">,</span> beta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span></code></pre>
<h3 id="discriminatorloss">Discriminator loss</h3>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-5-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right center left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0 thickmathspace&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;munder&gt;&lt;mo form=&quot;prefix&quot;&gt;min&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/munder&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;munderover&gt;&lt;mo movablelimits=&quot;false&quot;&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/munderover&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo fence=&quot;true&quot; stretchy=&quot;true&quot; symmetric=&quot;true&quot;&gt;&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mo fence=&quot;true&quot; stretchy=&quot;true&quot; symmetric=&quot;true&quot;&gt;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-473" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-474" class="mjx-mrow"><span id="MJXc-Node-475" class="mjx-mtable" style="vertical-align: -2.046em; padding: 0px 0.167em;"><span class="mjx-table"><span id="MJXc-Node-476" class="mjx-mtr" style="height: 3.181em;"><span id="MJXc-Node-477" class="mjx-mtd" style="padding: 0px; text-align: right; width: 4.606em;"><span id="MJXc-Node-478" class="mjx-mrow"><span id="MJXc-Node-479" class="mjx-munderover"><span class="mjx-itable"><span class="mjx-row"><span class="mjx-cell"><span class="mjx-op"><span id="MJXc-Node-480" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">min</span></span></span></span></span><span class="mjx-row"><span class="mjx-under" style="font-size: 70.7%; padding-top: 0.236em; padding-bottom: 0.141em; padding-left: 0.944em;"><span id="MJXc-Node-481" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span></span></span><span id="MJXc-Node-482" class="mjx-mfrac MJXc-space1"><span class="mjx-box MJXc-stacked" style="width: 1.088em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 1.088em; top: -1.368em;"><span id="MJXc-Node-483" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span><span class="mjx-denominator" style="width: 1.088em; bottom: -0.711em;"><span id="MJXc-Node-484" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.085em;">N</span></span></span><span style="border-bottom: 1.5px solid; top: -0.28em; width: 1.088em;" class="mjx-line"></span></span><span style="height: 2.078em; vertical-align: -0.711em;" class="mjx-vsize"></span></span><span id="MJXc-Node-485" class="mjx-munderover MJXc-space1"><span class="mjx-itable"><span class="mjx-row"><span class="mjx-cell"><span class="mjx-stack"><span class="mjx-over" style="font-size: 70.7%; padding-bottom: 0.258em; padding-top: 0.141em; padding-left: 0.577em;"><span id="MJXc-Node-492" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.085em;">N</span></span></span><span class="mjx-op"><span id="MJXc-Node-486" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.726em; padding-bottom: 0.726em;">∑</span></span></span></span></span></span><span class="mjx-row"><span class="mjx-under" style="font-size: 70.7%; padding-top: 0.236em; padding-bottom: 0.141em; padding-left: 0.21em;"><span id="MJXc-Node-487" class="mjx-texatom" style=""><span id="MJXc-Node-488" class="mjx-mrow"><span id="MJXc-Node-489" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span><span id="MJXc-Node-490" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-491" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span></span></span></span></span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-493" class="mjx-mtd" style="padding: 0px 0.139em 0px 0px; width: 0.778em;"><span id="MJXc-Node-494" class="mjx-mrow" style="margin-top: 0.776em;"><span id="MJXc-Node-495" class="mjx-mi"></span><span id="MJXc-Node-496" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-497" class="mjx-mtd" style="padding: 0px 0px 0px 0.139em; text-align: left; width: 21.667em;"><span id="MJXc-Node-498" class="mjx-mrow" style="margin-top: 0.776em;"><span id="MJXc-Node-499" class="mjx-mrow"><span id="MJXc-Node-500" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-501" class="mjx-mrow"><span id="MJXc-Node-502" class="mjx-mrow"><span id="MJXc-Node-503" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-504" class="mjx-mrow"><span id="MJXc-Node-505" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.404em; padding-bottom: 0.565em;">log</span></span><span id="MJXc-Node-506" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-507" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-508" class="mjx-mrow"><span id="MJXc-Node-509" class="mjx-mrow"><span id="MJXc-Node-510" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-511" class="mjx-mrow"><span id="MJXc-Node-512" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span><span id="MJXc-Node-513" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-514" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-515" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-516" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span><span id="MJXc-Node-517" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-518" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-519" class="mjx-mrow"><span id="MJXc-Node-520" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-521" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-522" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span></span><span id="MJXc-Node-523" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-524" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-525" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-526" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-528" class="mjx-texatom" style=""><span id="MJXc-Node-529" class="mjx-mrow"><span id="MJXc-Node-530" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span><span id="MJXc-Node-531" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-527" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-532" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-533" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-534" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span></span><span id="MJXc-Node-535" class="mjx-mo" style="width: 0.12em;"></span></span><span id="MJXc-Node-536" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">+</span></span><span id="MJXc-Node-537" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.404em; padding-bottom: 0.565em;">log</span></span><span id="MJXc-Node-538" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-539" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-540" class="mjx-mrow"><span id="MJXc-Node-541" class="mjx-mrow"><span id="MJXc-Node-542" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-543" class="mjx-mrow"><span id="MJXc-Node-544" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-545" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-546" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span><span id="MJXc-Node-547" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-548" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-549" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-550" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-552" class="mjx-texatom" style=""><span id="MJXc-Node-553" class="mjx-mrow"><span id="MJXc-Node-554" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-555" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-551" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-556" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-557" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span></span><span id="MJXc-Node-558" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span><span class="mjx-strut"></span></span></span></span><span id="MJXc-Node-559" class="mjx-mtr" style="height: 1.411em;"><span id="MJXc-Node-560" class="mjx-mtd" style="padding: 0.15em 0px 0px; text-align: right;"><span id="MJXc-Node-561" class="mjx-mrow" style="margin-top: -0.113em;"><span id="MJXc-Node-562" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.28em; padding-bottom: 0.324em;">&nbsp;</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-563" class="mjx-mtd" style="padding: 0.15em 0.139em 0px 0px;"><span id="MJXc-Node-564" class="mjx-mrow" style="margin-top: -0.113em;"><span id="MJXc-Node-565" class="mjx-mi"></span><span id="MJXc-Node-566" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">+</span></span><span class="mjx-strut"></span></span></span><span id="MJXc-Node-567" class="mjx-mtd" style="padding: 0.15em 0px 0px 0.139em; text-align: left;"><span id="MJXc-Node-568" class="mjx-mrow" style="margin-top: -0.113em;"><span id="MJXc-Node-569" class="mjx-mrow"><span id="MJXc-Node-570" class="mjx-mo" style="width: 0.12em;"></span><span id="MJXc-Node-571" class="mjx-mrow"><span id="MJXc-Node-572" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-573" class="mjx-mrow"><span id="MJXc-Node-574" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.404em; padding-bottom: 0.565em;">log</span></span><span id="MJXc-Node-575" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-576" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-577" class="mjx-mrow"><span id="MJXc-Node-578" class="mjx-mrow"><span id="MJXc-Node-579" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-580" class="mjx-mrow"><span id="MJXc-Node-581" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-582" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.485em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-583" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span><span id="MJXc-Node-584" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-585" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-586" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-587" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span><span id="MJXc-Node-588" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-589" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-590" class="mjx-mrow"><span id="MJXc-Node-591" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-592" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">G</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-593" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">w</span></span></span></span><span id="MJXc-Node-594" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-595" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-596" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-597" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-599" class="mjx-texatom" style=""><span id="MJXc-Node-600" class="mjx-mrow"><span id="MJXc-Node-601" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">L</span></span><span id="MJXc-Node-602" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-598" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-603" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-604" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-605" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span><span id="MJXc-Node-606" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">+</span></span><span id="MJXc-Node-607" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.404em; padding-bottom: 0.565em;">log</span></span><span id="MJXc-Node-608" class="mjx-mo"><span class="mjx-char"></span></span><span id="MJXc-Node-609" class="mjx-texatom MJXc-space1"><span id="MJXc-Node-610" class="mjx-mrow"><span id="MJXc-Node-611" class="mjx-mrow"><span id="MJXc-Node-612" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-613" class="mjx-mrow"><span id="MJXc-Node-614" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-615" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.485em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-616" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span><span id="MJXc-Node-617" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.284em; padding-bottom: 0.404em;">−</span></span><span id="MJXc-Node-618" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-619" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">D</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-620" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.284em;">θ</span></span></span></span><span id="MJXc-Node-621" class="mjx-mrow MJXc-space1"><span id="MJXc-Node-622" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">(</span></span><span id="MJXc-Node-623" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.064em;"><span id="MJXc-Node-624" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.064em;">I</span></span></span><span class="mjx-stack" style="vertical-align: -0.311em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0.188em; padding-right: 0.071em;"><span id="MJXc-Node-626" class="mjx-texatom" style=""><span id="MJXc-Node-627" class="mjx-mrow"><span id="MJXc-Node-628" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-629" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">R</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-625" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.444em; padding-bottom: 0.284em;">i</span></span></span></span></span><span id="MJXc-Node-630" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span><span id="MJXc-Node-631" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span></span></span></span><span id="MJXc-Node-632" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span><span id="MJXc-Node-633" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.646em; padding-bottom: 0.646em;">)</span></span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right center left" rowspacing="3pt" columnspacing="0 thickmathspace" displaystyle="true"><mtr><mtd><munder><mo form="prefix">min</mo><mi>θ</mi></munder><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo movablelimits="false">∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover></mtd><mtd><mi></mi><mo>−</mo></mtd><mtd><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mrow><mo>(</mo><mrow><mn>1</mn><mo>−</mo><msub><mi>D</mi><mi>θ</mi></msub><mrow><mo>(</mo><mrow><msub><mi>G</mi><mi>w</mi></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>L</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow></mrow><mo fence="true" stretchy="true" symmetric="true"></mo></mrow><mo>+</mo><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mrow><mo>(</mo><mrow><msub><mi>D</mi><mi>θ</mi></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>H</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow></mrow><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mtext>&nbsp;</mtext></mtd><mtd><mi></mi><mo>+</mo></mtd><mtd><mrow><mo fence="true" stretchy="true" symmetric="true"></mo><mrow><mo>(</mo><mrow><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mrow><mo>(</mo><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mi>D</mi><mi>θ</mi></msub><mrow><mo>(</mo><mrow><msub><mi>G</mi><mi>w</mi></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>L</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow><mo>+</mo><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mrow><mo>(</mo><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mi>D</mi><mi>θ</mi></msub><mrow><mo>(</mo><msubsup><mi>I</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>H</mi><mi>R</mi></mrow></msubsup><mo>)</mo></mrow></mrow><mo>)</mo></mrow></mrow></mrow><mo>)</mo></mrow><mo>)</mo></mrow></mtd></mtr></mtable></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-5">\begin{eqnarray}\min\limits_\theta\frac{1}{N}\sum\limits_{i = 1}^N &-&\left(\left(\log{\left(1 - D_\theta\left(G_w\left(I_i^{LR}\right)\right)\right)}\right. + \log{\left(D_\theta\left(I_i^{HR}\right)\right)}\right) \\\ &+& \left.\left(\log{\left(y_i - D_\theta\left(G_w\left(I_i^{LR}\right)\right)\right)} + \log{\left(y_i - D_\theta\left(I_i^{HR}\right)\right)}\right)\right)\end{eqnarray}</script></p>
<p>Equivalent code:</p>
<pre class=" language-python"><code class=" language-python" data-language="python">loss_D <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>ones <span class="token operator">-</span> SR_gan <span class="token operator">+</span> eps<span class="token punctuation">)</span> <span class="token operator">+</span> torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>HR_gan <span class="token operator">+</span> eps<span class="token punctuation">)</span> \<span class="token lf">
</span><span class="token operator">+</span> torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>label <span class="token operator">-</span> SR_clc <span class="token operator">+</span> eps<span class="token punctuation">)</span> <span class="token operator">+</span> torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>label <span class="token operator">-</span> clc_HR <span class="token operator">+</span> eps<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span></code></pre>
<h1 id="trainingthearchitecture">Training the architecture</h1>
<p>In order to train the architecture, multiple step must be followed.</p>
<h2 id="dataset">Dataset</h2>
<p>The first step is to define a dataset. The dataset used by the authors is <a href="http://mmlab.ie.cuhk.edu.hk/projects/WIDERFace/">WIDER FACE</a> which is composed of 32,203 images and 393,703 faces with a high degree of variability in scale, pose and occlusion.</p>
<p><img src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/5.jpg" alt="WIDER FACE dataset"></p>
<p>We will not provide the dataset loader implementation here because it is a fairly long implementation. See <code>dataset.py</code> from the full implementation for more details. The following code is an excerpt from <code>train.py</code> and is using our implementation directly:</p>
<pre class=" language-python"><code class=" language-python" data-language="python">transform <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token lf">
</span>trainset <span class="token operator">=</span> WIDERFACE<span class="token punctuation">(</span>gt_file<span class="token operator">=</span><span class="token string">"wider_face_split/wider_face_train_bbx_gt.txt"</span><span class="token punctuation">,</span> img_dir<span class="token operator">=</span><span class="token string">"WIDER_train/images/"</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>transform<span class="token punctuation">,</span> target_transform<span class="token operator">=</span>transform<span class="token punctuation">)</span><span class="token lf">
</span>trainloader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>trainset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> num_workers<span class="token operator">=</span>num_workers<span class="token punctuation">)</span><span class="token lf">
</span></code></pre>
<p>The transform first convert the images to tensors and then normalize 
the images. The following two line instanciate the dataset and define 
the data loader respectively. Our data loader is providing faces and 
non-faces for the training.</p>
<h2 id="generatorpretraining">Generator pre-training</h2>
<p>To avoid undesirable local optima, the generator must be pre-trained 
with an MSE loss for at least a couple of epochs prior to training with 
the complete loss.</p>
<pre class=" language-python"><code class=" language-python" data-language="python">generator <span class="token operator">=</span> G<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>mse <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token lf">
</span>optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>generator<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Pretraining the generator with a MSE loss for "</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>num_epoch_pretrain<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" epoch"</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_epoch_pretrain<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>    running_loss <span class="token operator">=</span> <span class="token number">0.0</span><span class="token lf">
</span>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> data <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>trainloader<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        <span class="token comment" spellcheck="true">#Get the inputs
</span>        LR<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> <span class="token number">face</span> <span class="token operator">=</span> data<span class="token lf">
</span>        LR <span class="token operator">=</span> LR<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token lf">
</span>        HR <span class="token operator">=</span> HR<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token comment" spellcheck="true">#Zero the parameter gradients
</span>        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token comment" spellcheck="true">#Forward + backward + optimize
</span>        SR_g1<span class="token punctuation">,</span> SR_g2 <span class="token operator">=</span> generator<span class="token punctuation">(</span>LR<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        loss <span class="token operator">=</span> mse<span class="token punctuation">(</span>SR_g2<span class="token punctuation">,</span> HR<span class="token punctuation">)</span><span class="token lf">
</span>        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span>        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token comment" spellcheck="true">#Print statistics
</span>        running_loss <span class="token operator">+</span><span class="token operator">=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">200</span> <span class="token operator">==</span> <span class="token number">199</span><span class="token punctuation">:</span><span class="token lf">
</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[%d, %5d] loss: %.3f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> running_loss <span class="token operator">/</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span>            running_loss <span class="token operator">=</span> <span class="token number">0.0</span><span class="token lf">
</span></code></pre>
<h2 id="trainingthefullnetwork">Training the full network</h2>
<p>The last step is the training of the full network including the 
discriminator. The training is quite a bit more complicated than 
training a simple CNN. Two optimizer must be employed, one for the 
generator and one for the discriminator. The authors are using the Adam 
optimizer with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-6-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.9&lt;/mn&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-634" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-635" class="mjx-mrow"><span id="MJXc-Node-636" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.007em;"><span id="MJXc-Node-637" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.485em; padding-right: 0.007em;">β</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-638" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.324em;">1</span></span></span></span><span id="MJXc-Node-639" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-640" class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.364em;">0.9</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>β</mi><mn>1</mn></msub><mo>=</mo><mn>0.9</mn></math></span></span><script type="math/tex" id="MathJax-Element-6">\beta_1 = 0.9</script>. The trade off weights used in the loss are <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-7-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.001&lt;/mn&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-641" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-642" class="mjx-mrow"><span id="MJXc-Node-643" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.203em; padding-bottom: 0.284em;">α</span></span><span id="MJXc-Node-644" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-645" class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.364em;">0.001</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mo>=</mo><mn>0.001</mn></math></span></span><script type="math/tex" id="MathJax-Element-7">\alpha = 0.001</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-8-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.01&lt;/mn&gt;&lt;/math&gt;" role="presentation"><span id="MJXc-Node-646" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-647" class="mjx-mrow"><span id="MJXc-Node-648" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.485em; padding-bottom: 0.485em; padding-right: 0.007em;">β</span></span><span id="MJXc-Node-649" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.082em; padding-bottom: 0.324em;">=</span></span><span id="MJXc-Node-650" class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.364em;">0.01</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi><mo>=</mo><mn>0.01</mn></math></span></span><script type="math/tex" id="MathJax-Element-8">\beta = 0.01</script>.</p>
<pre class=" language-python"><code class=" language-python" data-language="python">discriminator <span class="token operator">=</span> VGG19<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>opt_G <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>generator<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span>opt_D <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>discriminator<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>ones <span class="token operator">=</span> Variable<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token lf">
</span>eps <span class="token operator">=</span> Variable<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>np<span class="token punctuation">.</span>full<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token lf">
</span>alpha <span class="token operator">=</span> <span class="token number">0.001</span><span class="token lf">
</span>beta <span class="token operator">=</span> <span class="token number">0.01</span><span class="token lf">
</span><span class="token lf">
</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Training the complete solution"</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_epoch<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>    running_loss_G <span class="token operator">=</span> <span class="token number">0.0</span><span class="token lf">
</span>    running_loss_D <span class="token operator">=</span> <span class="token number">0.0</span><span class="token lf">
</span>    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> data <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>trainloader<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token lf">
</span>        <span class="token comment" spellcheck="true"># get the inputs
</span>        LR<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> label <span class="token operator">=</span> data<span class="token lf">
</span>        LR <span class="token operator">=</span> LR<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token lf">
</span>        HR <span class="token operator">=</span> HR<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token lf">
</span>        label <span class="token operator">=</span> label<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token comment" spellcheck="true"># zero the parameter gradients
</span>        opt_G<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span>        opt_D<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token comment" spellcheck="true"># forward + backward + optimize
</span>        SR_g1<span class="token punctuation">,</span> SR_g2 <span class="token operator">=</span> generator<span class="token punctuation">(</span>LR<span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        SR_gan<span class="token punctuation">,</span> SR_clc <span class="token operator">=</span> discriminator<span class="token punctuation">(</span>F<span class="token punctuation">.</span>interpolate<span class="token punctuation">(</span>SR_g2<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"bilinear"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        loss_G <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>ones <span class="token operator">-</span> SR_gan <span class="token operator">+</span> eps<span class="token punctuation">)</span><span class="token punctuation">,</span> alpha<span class="token punctuation">)</span> <span class="token operator">+</span> F<span class="token punctuation">.</span>mse_loss<span class="token punctuation">(</span>SR_g1<span class="token punctuation">,</span> HR<span class="token punctuation">)</span> <span class="token operator">+</span> F<span class="token punctuation">.</span>mse_loss<span class="token punctuation">(</span>SR_g2<span class="token punctuation">,</span> HR<span class="token punctuation">)</span> <span class="token operator">+</span> torch<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>label <span class="token operator">-</span> SR_clc <span class="token operator">+</span> eps<span class="token punctuation">)</span><span class="token punctuation">,</span> beta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span>        loss_G<span class="token punctuation">.</span>backward<span class="token punctuation">(</span>retain_graph<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token lf">
</span>        opt_G<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        HR_gan<span class="token punctuation">,</span> clc_HR <span class="token operator">=</span> discriminator<span class="token punctuation">(</span>F<span class="token punctuation">.</span>interpolate<span class="token punctuation">(</span>HR<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"bilinear"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        loss_D <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>ones <span class="token operator">-</span> SR_gan <span class="token operator">+</span> eps<span class="token punctuation">)</span> <span class="token operator">+</span> torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>HR_gan <span class="token operator">+</span> eps<span class="token punctuation">)</span> <span class="token operator">+</span> torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>label <span class="token operator">-</span> SR_clc <span class="token operator">+</span> eps<span class="token punctuation">)</span> <span class="token operator">+</span> torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>label <span class="token operator">-</span> clc_HR <span class="token operator">+</span> eps<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span>        loss_D<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span>        opt_D<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span><span class="token lf">
</span>        <span class="token comment" spellcheck="true"># print statistics
</span>        running_loss_G <span class="token operator">+</span><span class="token operator">=</span> loss_G<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span>        running_loss_D <span class="token operator">+</span><span class="token operator">=</span> loss_D<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">200</span> <span class="token operator">==</span> <span class="token number">199</span><span class="token punctuation">:</span><span class="token lf">
</span>            end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[%d, %5d] loss_G: %.3f loss_D: %.3f time: %.3f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> running_loss_G <span class="token operator">/</span> <span class="token number">200</span><span class="token punctuation">,</span> running_loss_D <span class="token operator">/</span> <span class="token number">200</span><span class="token punctuation">,</span> end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token lf">
</span>            start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token lf">
</span>            running_loss_G <span class="token operator">=</span> <span class="token number">0.0</span><span class="token lf">
</span>            running_loss_D <span class="token operator">=</span> <span class="token number">0.0</span><span class="token lf">
</span><span class="token lf">
</span>    torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>generator<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"_net_G.pth"</span><span class="token punctuation">)</span><span class="token lf">
</span>    torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>discriminator<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"_net_D.pth"</span><span class="token punctuation">)</span><span class="token lf">
</span>    torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>opt_G<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"_opt_G.pth"</span><span class="token punctuation">)</span><span class="token lf">
</span>    torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>opt_D<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"_opt_D.pth"</span><span class="token punctuation">)</span><span class="token lf">
</span></code></pre>
<p>Note that we focused exclusively on the GAN part of the network. The 
GAN can be trained separately from the detector. However, the authors 
trained their detector end-to-end with the GAN and the face/non-face 
label were inferred by the detector and not known a priori.</p>
<h1 id="ablationstudies">Ablation studies</h1>
<p>The authors provided an ablation study of the architecture which is summarized in the following table:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Easy</th>
<th>Medium</th>
<th>Hard</th>
</tr>
</thead>
<tbody>
<tr>
<td>Baseline</td>
<td>0.932</td>
<td>0.922</td>
<td>0.858</td>
</tr>
<tr>
<td>w/o Refinement Network</td>
<td>0.940</td>
<td>0.929</td>
<td>0.863</td>
</tr>
<tr>
<td>w/o adv loss</td>
<td>0.935</td>
<td>0.925</td>
<td>0.867</td>
</tr>
<tr>
<td>w/o clc loss</td>
<td>0.936</td>
<td>0.927</td>
<td>0.865</td>
</tr>
<tr>
<td>Baseline+MES+adv+clc</td>
<td><strong>0.944</strong></td>
<td><strong>0.933</strong></td>
<td><strong>0.873</strong></td>
</tr>
</tbody>
</table>
<p>The Easy/Medium/Hard sub-datasets contain faces with heights larger 
than 50/30/10 pixels respectively. The results show a net gain in 
performance of the full architecture in comparison with the baseline and
 partial architectures.</p>
<h1 id="results">Results</h1>
<p>Here is an example of the authors results:<br>
<img src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/4.jpg" alt="Example results"></p>
<p>A comparison of the performance with the other approaches in the literature have also shown superior results:<br>
<img src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/6.png" alt="Comparison results"></p>
<h1 id="paperreference">Paper reference</h1>
<h2 id="ieee">IEEE</h2>
<p>Y. Bai, Y. Zhang, M. Ding, and B. Ghanem, “Finding tiny faces in the 
wild with generative adversarial network,” in Proceedings of the IEEE 
Conference on Computer Vision and Pattern Recognition, 2018, pp. 21–30. 
[Online]. Available: <a href="https://ivul.kaust.edu.sa/Pages/pub-tiny-faces.aspx">https://ivul.kaust.edu.sa/Pages/pub-tiny-faces.aspx</a>.</p>
<h2 id="bibtex">BibTeX</h2>
<pre><code>@inproceedings{bai2018finding,
  title={Finding tiny faces in the wild with generative adversarial network},
  author={Bai, Yancheng and Zhang, Yongqiang and Ding, Mingli and Ghanem, Bernard},
  booktitle={Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition},
  pages={21--30},
  year={2018}
}
</code></pre>
<h1 id="otherreferences">Other references</h1>
<p>[1] C. Ledig et al., “Photo-realistic single image super-resolution 
using a generative adversarial network,” in Proceedings of the IEEE 
conference on computer vision and pattern recognition, 2017, pp. 
4681–4690.</p>
</div>
            </section>


            <footer class="post-full-footer">


                    
<section class="author-card">
        <img class="author-profile-image" src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/e9c0fa6b5bc2dcfa16d8e9932d4ce0bb.png" alt="Andy Couturier">
    <section class="author-card-content">
        <h4 class="author-card-name"><a href="https://smoolak.com/author/andy/">Andy Couturier</a></h4>
            <p>Read <a href="https://smoolak.com/author/andy/">more posts</a> by this author.</p>
    </section>
</section>
<div class="post-full-footer-right">
    <a class="author-card-button" href="https://smoolak.com/author/andy/">Read More</a>
</div>


            </footer>


        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">



        </div>
    </div>
</aside>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://smoolak.com/">
                <img src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/icon-1.png" alt="Smoolak's blog icon">
            <span>Smoolak's blog</span>
        </a>
    </div>
    <span class="floating-header-divider">—</span>
    <div class="floating-header-title">Finding Tiny Faces in the Wild with Generative Adversarial Network</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"></path>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network&amp;url=https://smoolak.com/404/" onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"></path></svg>
        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://smoolak.com/404/" onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"></path></svg>
        </a>
    </div>
    <progress class="progress" value="0" max="12954">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://smoolak.com/">Smoolak's blog</a> © 2019</section>
                <nav class="site-footer-nav">
                    <a href="https://smoolak.com/">Latest Posts</a>
                    
                    <a href="https://twitter.com/Smoolak" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://ghost.org/" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>


    <script src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/jquery-3.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/jquery.js"></script>


    <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();

});
</script>


    <script type="text/javascript" src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/prism.js"></script>

<script type="text/javascript" async="" src="Finding%20Tiny%20Faces%20in%20the%20Wild%20with%20Generative%20Adversarial%20Network_files/MathJax.js">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]],
        processEscapes: true
    }
});
</script>



</body></html>